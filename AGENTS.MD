# AGENTS.MD - PDFMake Template Builder

This file contains instructions and best practices for AI coding agents working on this project.

## ‚ö†Ô∏è IMPORTANT: Human-in-the-Loop Development

**The human developer (user) is in charge of running all terminal commands and managing the development environment.** Do not execute terminal commands yourself. Only provide the commands for the user to run.

## üìã Project Overview

This is a PDFMake Template Builder - a modern web application for creating and customizing PDFMake templates through a visual drag-and-drop interface. The application is built with Next.js, TypeScript, and Tailwind CSS.

### Key Features
- Visual drag-and-drop template builder
- Real-time PDF preview
- Element customization (text, tables, images, lists)
- Template import/export
- Local storage persistence
- Responsive design with dark mode

## üöÄ Development Environment Setup

### Prerequisites
- Node.js 18+
- Bun (recommended) or npm
- Git

### Setup Commands (Run by Human)
```bash
# Install dependencies
bun install

# Set up @shadcn/ui
bunx shadcn@latest init --yes

# Start development server
bun dev

# Build for production
bun build

# Start production server
bun start

# Run linting
bun lint

# Run TypeScript checking
bun type-check

# Run lint only on changed files (fast inner loop) and fail on warnings
bun lint -- --cache --max-warnings=0

# Build like Vercel (Next.js production build)
bun run build
```

## üìÅ Project Structure

```
pdfmake-builder/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ app/                 # Next.js App Router pages
‚îÇ   ‚îú‚îÄ‚îÄ components/          # React components
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ui/              # Reusable UI components
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ elements/        # Template element components
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ canvas/          # Canvas and drag-drop logic
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ preview/         # PDF preview system
‚îÇ   ‚îú‚îÄ‚îÄ services/           # Business logic and utilities
‚îÇ   ‚îú‚îÄ‚îÄ types/              # TypeScript type definitions
‚îÇ   ‚îú‚îÄ‚îÄ lib/                # External library configurations
‚îÇ   ‚îî‚îÄ‚îÄ utils/              # Utility functions
‚îú‚îÄ‚îÄ docs/                   # Documentation and examples
‚îÇ   ‚îú‚îÄ‚îÄ plan/               # Development planning docs
‚îÇ   ‚îî‚îÄ‚îÄ examples/           # pdfMake example templates
‚îú‚îÄ‚îÄ public/                 # Static assets
‚îî‚îÄ‚îÄ package.json
```

## üé® Code Style Guidelines

### TypeScript
- **Strict mode enabled** - All TypeScript strict checks must pass
- **Explicit types** - Avoid `any` type, use proper type definitions
- **Interface over type** - Use interfaces for object shapes
- **Type imports** - Use `import type` for type-only imports
- **No `any`** - Do not introduce `any`. Extend `src/types/index.ts` with missing shapes.
- **Use app types** - Prefer `DocDefinition`, `TableNode`, etc. from `src/types` over casting.

### React
- **Functional components** - Use modern React patterns
- **Custom hooks** - Extract reusable logic into custom hooks
- **Component composition** - Prefer composition over inheritance
- **Props interface** - Define props interfaces for all components
- **Stable hook deps** - Keep dependency arrays stable. Do not depend on freshly created objects; memoize inputs first (e.g. `const ddStable = useMemo(() => dd ?? {}, [dd])`).
- **No unused** - Remove unused imports/variables and avoid broad eslint-disable directives.

### Styling
- **Tailwind CSS** - Use utility-first approach
- **Consistent naming** - Follow Tailwind conventions
- **Responsive design** - Mobile-first approach
- **Dark mode support** - Use CSS custom properties for theming

### General
- **Single quotes** - Use single quotes for strings
- **No semicolons** - Omit semicolons where possible
- **ES6+ features** - Use modern JavaScript features
- **Descriptive names** - Use clear, descriptive variable/function names

## üß™ Testing Instructions

### Testing Strategy
- **Unit tests** - Test individual functions and components
- **Integration tests** - Test component interactions
- **E2E tests** - Test complete user workflows
- **Visual regression** - Ensure UI consistency

### Test Commands (Run by Human)
```bash
# Run all tests
bun test

# Run tests in watch mode
bun test:watch

# Run tests with coverage
bun test:coverage

# Run specific test file
bun test -- <filename>
```

## üîß Development Best Practices

### Git Workflow
- **Feature branches** - Create branches for each feature/milestone
- **Descriptive commits** - Write clear commit messages
- **Pull request reviews** - Submit work for human review
- **Squash commits** - Clean up commit history before merge

### Code Organization
- **Single responsibility** - Each file has one clear purpose
- **DRY principle** - Don't repeat yourself
- **SOLID principles** - Follow software design principles
- **Clean architecture** - Separate concerns properly
- **Types first** - When UI needs new shapes, update `src/types/index.ts` instead of casting.

### Performance
- **Code splitting** - Use dynamic imports for large components
- **Memoization** - Use React.memo and useMemo appropriately
- **Stable memo** - Depend on primitives or memoized objects in hooks to avoid re-renders.
- **Image optimization** - Compress and lazy load images
- **Bundle analysis** - Monitor bundle size regularly

### Error Handling
- **Graceful degradation** - Handle errors without breaking the app
- **User feedback** - Provide clear error messages
- **Logging** - Log errors for debugging (development only)
- **Recovery options** - Allow users to recover from errors

## üö® Critical Considerations

### Security
- **Input validation** - Sanitize all user inputs
- **XSS prevention** - Escape HTML content
- **Content Security Policy** - Implement CSP headers
- **File upload safety** - Validate uploaded files

### Accessibility
- **WCAG compliance** - Follow accessibility guidelines
- **Keyboard navigation** - Support keyboard-only usage
- **Screen readers** - Ensure compatibility with screen readers
- **Color contrast** - Maintain proper contrast ratios

### Browser Compatibility
- **Modern browsers** - Chrome, Firefox, Safari, Edge
- **Progressive enhancement** - Core functionality works everywhere
- **Polyfills** - Add only when necessary
- **Mobile support** - Test on various screen sizes

### CI/Build parity
- **Zero warnings policy** - Run `bun lint -- --cache --max-warnings=0` and fix all warnings locally before pushing.
- **Type-safety gate** - `bun type-check` must pass locally before pushing.
- **Production build gate** - Run `bun run build` locally; the build must succeed.
- **Avoid disables** - Do not use broad eslint disables; scope and justify any exceptions in review.

## üìù Documentation Requirements

### Code Documentation
- **JSDoc comments** - Document complex functions
- **Component props** - Document all component props
- **Type definitions** - Clear type descriptions
- **Usage examples** - Include examples in comments

### Project Documentation
- **README updates** - Keep README current
- **API documentation** - Document public APIs
- **Architecture decisions** - Record important decisions
- **Change log** - Track significant changes

## üîÑ Development Workflow

### Daily Workflow
1. **Check current milestone** - Review development-plan.md
2. **Implement features** - Focus on current milestone only
3. **Test thoroughly** - Ensure all requirements are met
4. **Run gates locally (must pass)**
   - `bun lint -- --cache --max-warnings=0`
   - `bun type-check`
   - `bun run build`
5. **Code review** - Submit for human review
6. **Iterate** - Fix issues and improve based on feedback

### Communication
- **Clear instructions** - Provide specific implementation details
- **Progress updates** - Report completion of tasks
- **Blockers** - Immediately report any blocking issues
- **Questions** - Ask for clarification when needed

### Quality Assurance
- **Self-review** - Check code against guidelines
- **Testing** - Thoroughly test implemented features
- **Edge cases** - Consider and handle edge cases
- **Performance** - Ensure good performance
- **Accessibility** - Verify accessibility compliance
- **No warnings in CI** - PRs must not introduce ESLint warnings; Next.js build should be clean.

## üéØ Success Criteria

### Code Quality
- ‚úÖ No TypeScript errors
- ‚úÖ No ESLint warnings
- ‚úÖ All tests passing
- ‚úÖ Good performance metrics
- ‚úÖ Accessibility compliant

### Feature Completeness
- ‚úÖ Meets milestone requirements
- ‚úÖ Handles edge cases
- ‚úÖ Provides good user experience
- ‚úÖ Integrates well with existing code
- ‚úÖ Follows established patterns

### Documentation
- ‚úÖ Code is well-documented
- ‚úÖ README is updated
- ‚úÖ Changes are recorded
- ‚úÖ Examples are provided
- ‚úÖ Tests are included

Remember: **Always wait for human approval before proceeding to the next milestone.** The human developer controls the development environment and testing process.
